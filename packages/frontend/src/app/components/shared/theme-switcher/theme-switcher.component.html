<div class="theme-switcher" [class.open]="isOpen">
  <!-- Mode Toggle Button (Moddly) -->
  <app-mode-toggler
    [initialMode]="currentMode === 'dark' ? 'dark' : 'light'"
    (modeChange)="onModeChange($event)">
  </app-mode-toggler>
  
  <!-- Quick Theme Toggle Button -->
  <button
    class="theme-toggle-btn"
    (click)="cycleTheme()"
    [title]="'Current: ' + (currentThemeInfo?.name || 'Default')"
    aria-label="Switch to next theme">
    <i class="fas fa-palette" aria-hidden="true"></i>
    <span class="theme-name">{{ currentThemeInfo?.name || 'Default' }}</span>
  </button>
  
  <!-- Dropdown Toggle -->
  <button 
    class="dropdown-toggle" 
    (click)="toggleDropdown()" 
    aria-label="Open theme selector"
    [attr.aria-expanded]="isOpen">
    <i class="fas fa-chevron-down" [class.rotated]="isOpen" aria-hidden="true"></i>
  </button>
  
  <!-- Theme Dropdown -->
  <div class="theme-dropdown" [class.show]="isOpen" role="menu">
    <div class="dropdown-header">
      <h4>Choose Theme</h4>
      <p>Select your preferred color scheme</p>
    </div>
    
    <div class="theme-options">
      @for (theme of themesForCurrentMode; track theme.id) {
        <button
          class="theme-option"
          [class.active]="theme.id === currentThemeId"
          (click)="selectTheme(theme.id)"
          role="menuitem"
          [attr.aria-current]="theme.id === currentThemeId ? 'true' : null">

          <div class="theme-preview" [ngClass]="getThemePreviewClass(theme.id)">
            <div class="preview-pattern"></div>
          </div>

          <div class="theme-info">
            <h5>{{ theme.name }}</h5>
            <p>{{ theme.description }}</p>
            <small class="theme-meta">{{ theme.mode.name }} â€¢ {{ theme.colors.name }}</small>
          </div>

          @if (theme.id === currentThemeId) {
            <i class="fas fa-check theme-check" aria-hidden="true"></i>
          }
        </button>
      }
    </div>
    
    <div class="dropdown-footer">
      <small>Themes are saved automatically</small>
    </div>
  </div>
  
  <!-- Overlay -->
  @if (isOpen) {
    <div class="theme-overlay" (click)="toggleDropdown()"></div>
  }
</div>
